<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Certificate Designer</title>
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            background: #f0f0f0;
        }

        #canvas-container {
            position: relative;
            border: 2px dashed #ccc;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background: white;
            overflow: hidden;
        }

        .draggable {
            position: absolute;
            cursor: move;
            padding: 5px;
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid #000;
            white-space: nowrap;
            user-select: none;
            transform: translate(-50%, -50%);
        }

        .draggable:hover {
            background: rgba(255, 255, 100, 0.9);
            z-index: 10;
        }

        #controls {
            margin-bottom: 20px;
            text-align: center;
        }

        #output {
            margin-top: 20px;
            width: 80%;
            height: 150px;
        }

        .info {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>

<body>

    <h1>Certificate Layout Designer</h1>

    <div id="controls">
        <p>1. Upload your <code>template.jpg</code> to start.</p>
        <input type="file" id="fileInput" accept="image/*">
        <p class="info">2. Drag the text boxes to the correct positions on your certificate.</p>
        <p class="info">3. Copy the configuration JSON below and send it to the developer.</p>
    </div>

    <div id="canvas-container">
        <!-- Image will be loaded here -->
        <p style="padding: 50px; text-align: center; color: #999;">No Image Loaded</p>
    </div>

    <textarea id="output" readonly placeholder="Configuration JSON will appear here..."></textarea>

    <script>
        const container = document.getElementById('canvas-container');
        const fileInput = document.getElementById('fileInput');
        const output = document.getElementById('output');

        // Initial Layout State
        let layout = {
            name: { x: 512, y: 300, label: "CANDIDATE NAME" },
            hours: { x: 300, y: 450, label: "20 Hours" },
            position: { x: 700, y: 450, label: "Intern" },
            startDate: { x: 300, y: 600, label: "Jan 1, 2024" },
            endDate: { x: 700, y: 600, label: "Feb 1, 2024" },
            certId: { x: 900, y: 60, label: "ID: HF-2024-1234" }
        };

        let imgWidth = 1024;
        let imgHeight = 768;

        fileInput.addEventListener('change', function (e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (event) {
                const img = new Image();
                img.onload = function () {
                    imgWidth = img.width;
                    imgHeight = img.height;

                    // Set container size
                    container.style.width = imgWidth + 'px';
                    container.style.height = imgHeight + 'px';
                    container.innerHTML = ''; // Clear placeholder

                    // Set background
                    container.style.backgroundImage = `url(${event.target.result})`;
                    container.style.backgroundSize = 'contain';

                    // Create Draggables
                    Object.keys(layout).forEach(key => {
                        createDraggable(key, layout[key]);
                    });

                    updateOutput();
                }
                img.src = event.target.result;
            }
            reader.readAsDataURL(file);
        });

        function createDraggable(key, data) {
            const el = document.createElement('div');
            el.className = 'draggable';
            el.textContent = data.label;
            el.style.left = data.x + 'px';
            el.style.top = data.y + 'px';
            el.dataset.key = key;

            let isDragging = false;

            el.addEventListener('mousedown', (e) => {
                isDragging = true;
                el.style.zIndex = 100;
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                const rect = container.getBoundingClientRect();
                let x = e.clientX - rect.left;
                let y = e.clientY - rect.top;

                // Bounds check
                x = Math.max(0, Math.min(x, imgWidth));
                y = Math.max(0, Math.min(y, imgHeight));

                el.style.left = x + 'px';
                el.style.top = y + 'px';

                // Update state
                layout[key].x = Math.round(x);
                layout[key].y = Math.round(y);
                updateOutput();
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    el.style.zIndex = '';
                }
            });

            container.appendChild(el);
        }

        function updateOutput() {
            const cleanLayout = {};
            Object.keys(layout).forEach(k => {
                cleanLayout[k] = { x: layout[k].x, y: layout[k].y };
            });
            output.value = JSON.stringify(cleanLayout, null, 4);
        }
    </script>
</body>

</html>